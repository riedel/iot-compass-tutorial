<!DOCTYPE html>
<html lang="en">

<head>
    <title>IoT Demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="js/d3.js"></script>
    <script src="js/map.js"></script>
    <script src="js/compass.js"></script>
    <script src="js/indiana.js"></script>

    <link rel="stylesheet" href="css/bootstrap.css">

    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>

</head>

<body>
	<div id="iot"></div>
	<div class="container">
		<h1>My Room</h1>
		<ul class="nav nav-tabs">
			<li class="active"><a data-toggle="tab" href="#laptop">Laptop</a></li>
			<li><a data-toggle="tab" href="#lamp">Lamp</a></li>
		</ul>

		<div class="tab-content">
			<div id="laptop" data-x="100" data-y="100" class="tab-pane active">
				<h2>All about my Laptop</h2>
				<img src="img/laptop.jpg">
				<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
			</div>
			<div id="lamp" data-x="800" data-y="200" class="tab-pane">
				<h3>Lamp controller</h3>
				<img src="img/lamp.png">
				<p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.</p>
			</div>
		</div>
	</div>

</body>


<script type="text/javascript">

$(document).ready(function() {

	var things= {}

	$("ul.nav li a").each(function() {
		var item=$(this.hash)[0]

			things[item.id] = {
				location : { x: $(item).data("x"),	y: $(item).data("y")},
				label:item.id,
				img: $(item).find("img")[0].src
			}

	}
	)
	
	var me={};

	
	ithings = new IoTCompass("#iot",things);

	spatial= spatialAwareness({ "fov": 40 });

	togglehash=function(){
		var hashPieces = location.hash.split('?')
		atab=$('.nav-tabs a[href="'+hashPieces[0]+'"]')
		if(atab.length)
		{
			atab.tab('show')
		}
		else
		{
			[,me.x,me.y,me.dir]=hashPieces
			$.map(things,function(thing)
					{
					  thing.location.dir=spatial.cartesian2Degree(thing.location,me)
					}
					)
			ithings.update(things,me)
		}
	}

	togglehash()

	window.addEventListener("hashchange", togglehash, false);

	spatial.init(things,me);

	// Update thing positions
	document.addEventListener('orientation2d', function(evt) {
		ithings.update(things, {dir:evt.detail.dir});
	});
})

</script>

</html>
